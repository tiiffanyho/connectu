<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ConnectU | Community & Housing</title>
  <link rel="stylesheet" href="./css/styles.css" />
  <link rel="icon" href="./favicon.ico" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
  <style>
    body {
      background:
        radial-gradient(1200px 600px at 10% 10%, #7b61ff22, transparent),
        radial-gradient(900px 500px at 90% 90%, #34d39922, transparent),
        linear-gradient(180deg, #0f172a 0%, #0b1220 100%);
      color: #e6eef8;
      font-family:
        'Inter',
        system-ui,
        -apple-system,
        'Segoe UI',
        Roboto,
        'Helvetica Neue',
        Arial,
        sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .fullscreen-tabs {
      flex: 1;
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100vh;
      overflow: hidden;
      position: relative;
      z-index: 1;
    }

    .community-header {
      background: linear-gradient(180deg, rgba(15, 23, 42, 0.98), rgba(11, 18, 32, 0.99));
      border-bottom: 1px solid rgba(255,255,255,0.2);
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(16px);
      position: relative;
      z-index: 2;
    }

    .community-title {
      font-size: 2rem;
      font-weight: 900;
      letter-spacing: 2px;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .back-btn {
      background: linear-gradient(90deg, #8b5cf6, #06b6d4);
      color: #021124;
      border: none;
      padding: 0.75rem 1.25rem;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      font-size: 0.95rem;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      position: static;
      margin-left: 1rem;
    }
    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 36px rgba(2,6,23,0.35);
    }

    .tab-header {
      display: flex;
      gap: 0.5rem;
      padding: 1rem 2rem;
      background: rgba(15, 23, 42, 0.98);
      border-bottom: 1px solid rgba(255,255,255,0.2);
      overflow-x: auto;
      backdrop-filter: blur(16px);
      position: relative;
      z-index: 2;
    }

    .tab-header button {
      padding: 0.65rem 1rem;
      background: rgba(15, 23, 42, 0.85);
      color: #e6eef8;
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      white-space: nowrap;
      transition: all 0.25s ease;
      flex: 1;
      backdrop-filter: blur(8px);
    }

    .tab-header button:hover {
      background: rgba(15, 23, 42, 0.92);
      border-color: rgba(255,255,255,0.25);
      color: #fff;
    }

    .tab-header button.active {
      background: linear-gradient(90deg, #8b5cf6, #06b6d4);
      color: #021124;
      border-color: transparent;
    }

    .tab-content {
      flex: 1;
      overflow-y: auto;
      padding: 2.5rem 2rem 2rem 2rem;
      background: rgba(15, 23, 42, 0.95);
      animation: fadeIn 0.3s;
      position: relative;
      z-index: 1;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: none; }
    }

    .feature-list {
      color: #e6eef8;
      font-size: 1.08rem;
      line-height: 1.7;
      margin-top: 1.2rem;
    }
    .feature-list strong {
      color: #fff;
      font-weight: 700;
    }

    #heatMapContainer {
      width: 100%;
      height: 500px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 32px rgba(0,0,0,0.4);
      margin: 1.5rem 0;
      border: 1px solid rgba(255,255,255,0.08);
    }

    .university-label {
      color: #94a3b8;
      font-size: 0.95rem;
      text-align: center;
      margin-bottom: 0.5rem;
    }

    .housing-filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .housing-filters select, .housing-filters input {
      padding: 0.65rem 1rem;
      background: rgba(255,255,255,0.06);
      color: #cbd5e1;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      font-size: 0.9rem;
      font-family: inherit;
    }

    .housing-filters select:focus, .housing-filters input:focus {
      outline: none;
      background: rgba(255,255,255,0.1);
      border-color: #8b5cf6;
    }

    .budget-section {
      margin-bottom: 2rem;
    }

    .budget-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid rgba(139, 92, 246, 0.3);
    }

    .budget-icon {
      font-size: 1.5rem;
    }

    .budget-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: #fff;
    }

    .budget-range {
      font-size: 0.9rem;
      color: #94a3b8;
    }

    .listings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .listing-card {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(6, 182, 212, 0.05));
      border: 1px solid rgba(99, 102, 241, 0.2);
      border-radius: 12px;
      padding: 1.25rem;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .listing-card:hover {
      transform: translateY(-4px);
      border-color: rgba(139, 92, 246, 0.5);
      box-shadow: 0 12px 24px rgba(139, 92, 246, 0.2);
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(6, 182, 212, 0.1));
    }

    .listing-price {
      font-size: 1.4rem;
      font-weight: 800;
      color: #10b981;
      margin-bottom: 0.5rem;
    }

    .listing-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 0.5rem;
    }

    .listing-location {
      font-size: 0.9rem;
      color: #94a3b8;
      margin-bottom: 0.75rem;
    }

    .listing-details {
      display: flex;
      gap: 1rem;
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
      color: #cbd5e1;
    }

    .listing-detail-item {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .listing-amenities {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.75rem;
    }

    .amenity-tag {
      background: rgba(139, 92, 246, 0.2);
      color: #a78bfa;
      padding: 0.25rem 0.65rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .no-listings {
      padding: 2rem;
      text-align: center;
      color: #94a3b8;
      font-size: 1rem;
    }

    @media (max-width: 600px) {
      .tab-content { padding: 1.2rem 0.5rem; }
      .tab-header button { font-size: 1rem; }
      .listings-grid { grid-template-columns: 1fr; }
      .housing-filters { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="fullscreen-tabs">
    <div class="community-header">
      <h1 class="community-title">COMMUNITY</h1>
      <a href="./index.html" class="cta btn-secondary back-btn">‚Üê Home</a>
    </div>
    <div class="tab-header" id="tabHeader">
      <button class="active" data-tab="heatmap"> Campus Heat Map</button>
      <button data-tab="housing"> Housing Marketplace</button>
      <button data-tab="roommate"> Roommate Finder</button>
      <button data-tab="community"> Community Events</button>
      <button data-tab="resources"> Local Resources</button>
      <button data-tab="support"> Support & Safety</button>
    </div>
    <div class="tab-content" id="tabContent">
      <!-- Tab content will be injected here -->
    </div>
  </div>
  <script type="module">
    import { getUniversityCoords } from './js/university-data.js';
    
    const tabData = {
      heatmap: `
        <h2> Campus Heat Map ‚Äî Live Activity Visualization</h2>
        <div class="university-label" id="universityLabel"></div>
        <div id="heatMapContainer"></div>
        <p style="margin-top: 1rem; color: #94a3b8; font-size: 0.95rem; text-align: center;">Real-time campus activity visualization ‚Äî darker/denser areas indicate higher student presence</p>
        <ul class="feature-list">
          <li><strong>Live Activity Tracking:</strong> See where students are most active on campus in real time. Darker, denser color overlays indicate higher student presence and activity.</li>
          <li><strong>Event Hotspots:</strong> Identify trending locations for events, study groups, pop-up markets, and social gatherings. Discover new spots based on community activity.</li>
          <li><strong>Time-Based Insights:</strong> View activity patterns by time of day, day of week, and semester. Find the best times to visit popular locations.</li>
          <li><strong>Privacy-First Design:</strong> All location data is anonymized and aggregated to protect student privacy. No individual tracking.</li>
          <li><strong>Personalized Recommendations:</strong> Get suggestions for places to study, eat, or hang out based on your preferences and current crowd levels.</li>
        </ul>
      `,
      housing: `
        <h2>üè† Housing Marketplace</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
          <button onclick="loadHousingListings('real')" style="padding: 1rem; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 10px; font-weight: 700; font-size: 0.95rem; cursor: pointer; transition: all 0.3s ease;">
            üîç Browse Listings
          </button>
        </div>
        <div id="housingContent" style="min-height: 400px;">
          <div style="text-align: center; padding: 3rem; color: #94a3b8;">
            <p style="font-size: 1.1rem; margin-bottom: 1rem;">Click the button above to browse listings</p>
            <p style="font-size: 0.9rem;">üè† Real listings ‚Ä¢ üí∞ Budget-friendly options ‚Ä¢ üìç Near your campus</p>
          </div>
        </div>
      `,
      roommate: `
        <h2> Roommate Finder</h2>
        <ul class="feature-list">
          <li><strong>Matchmaking Quiz:</strong> Fill out a detailed lifestyle and preferences quiz covering sleep schedule, study habits, cleanliness level, social preferences, pet allergies, and more. Get a compatibility score with every potential roommate.</li>
          <li><strong>Profile Cards:</strong> View detailed profiles with bios, interests, major/year, social links, lifestyle photos, and mutual connections. See verified student status and background check options.</li>
          <li><strong>Direct Messaging:</strong> Chat securely with potential roommates in-app before making a decision. Share documents like lease agreements, schedule video calls, and exchange references.</li>
          <li><strong>Roommate Groups:</strong> Form or join groups for shared housing arrangements (2-4+ roommates). Group chat, shared calendar, chore rotation planner, and expense splitting tools included.</li>
          <li><strong>Compatibility Insights:</strong> See detailed breakdowns of your compatibility with potential roommates based on habits, schedules, and values. Get tips for successful cohabitation.</li>
          <li><strong>Safety Features:</strong> Report concerns anonymously, verify student status, and access mediation resources if conflicts arise.</li>
        </ul>
      `,
      community: `
        <h2> Community Events</h2>
        <ul class="feature-list">
          <li><strong>Event Calendar:</strong> Discover upcoming campus and local events, workshops, concerts, game nights, and meetups. Filter by category (social, academic, cultural, sports), popularity, date range, and location. Sync with your personal calendar.</li>
          <li><strong>Host an Event:</strong> Create and promote your own events to the student community. Set event details, upload photos/flyers, manage RSVPs, send updates and reminders to attendees, and track attendance.</li>
          <li><strong>RSVP & Reminders:</strong> RSVP to events with one tap and get push notifications and email reminders before events start. Get directions, parking info, and last-minute updates directly.</li>
          <li><strong>Interest Groups:</strong> Join or create groups based on hobbies (photography, hiking, gaming), causes (sustainability, mental health), or academic interests (coding club, debate team). Group chat, event planning tools, and shared resources included.</li>
          <li><strong>Event Discovery:</strong> Get personalized event recommendations based on your interests and past attendance. See what your friends are attending and trending events on campus.</li>
          <li><strong>Check-In & Rewards:</strong> Check in at events to earn points and badges. Unlock exclusive perks and early access to popular events.</li>
        </ul>
      `,
      resources: `
        <h2> Local Resources</h2>
        <ul class="feature-list">
          <li><strong>Essential Services:</strong> Find comprehensive info on grocery stores, pharmacies, healthcare clinics, banks, post offices, gyms, and public transport near campus. See hours, reviews, distance from campus, and real-time availability.</li>
          <li><strong>Student Discounts:</strong> Access an updated database of exclusive deals and discounts for students at local businesses (restaurants, retail, entertainment, services). Show your student ID to redeem. Save hundreds per semester.</li>
          <li><strong>Moving Guides:</strong> Get detailed tips, checklists, and video tutorials for moving in/out, setting up utilities (internet, electricity, water), buying furniture on a budget, and settling into your new place. Download printable guides and access a moving day checklist.</li>
          <li><strong>Transportation Hub:</strong> View bus routes, train schedules, bike-sharing locations, and ride-sharing options. Get real-time transit updates and plan your commute.</li>
          <li><strong>Local Favorites:</strong> Discover hidden gems and student-favorite spots for food, coffee, study spaces, and entertainment recommended by the community.</li>
        </ul>
      `,
      support: `
        <h2> Support & Safety</h2>
        <ul class="feature-list">
          <li><strong>Emergency Contacts:</strong> Quick one-tap access to campus security, health services, counseling center, Title IX office, and local emergency services. Tap to call, message, or share your location for immediate assistance.</li>
          <li><strong>Report Issues:</strong> Anonymously report housing concerns, roommate conflicts, safety issues, or harassment for confidential mediation and support. Track the status of your report and receive updates.</li>
          <li><strong>Safety Tips & Resources:</strong> Read up on best practices for safe renting, living alone, walking at night, recognizing scams, and protecting your personal information. Get notified of campus safety alerts and local crime reports.</li>
          <li><strong>Support Groups:</strong> Connect with mental health resources, peer-led support groups (anxiety, depression, LGBTQ+, first-gen students), and confidential counseling services. Join chat groups and access crisis hotlines 24/7.</li>
          <li><strong>Wellness Check-Ins:</strong> Use mood tracking tools, set wellness goals, and access self-care resources. Get reminders to take breaks and connect with support when needed.</li>
          <li><strong>Community Guidelines:</strong> Review community standards, anti-harassment policies, and reporting procedures to foster a safe and inclusive environment for all students.</li>
        </ul>
      `
    };

    const tabHeader = document.getElementById('tabHeader');
    const tabContent = document.getElementById('tabContent');
    let activeTab = 'heatmap';

    /**
     * Generate realistic heatmap data points around campus coordinates
     */
    function generateCampusHeatData(centerLat, centerLng) {
      const data = [];
      const hotspots = [
        { offset: [0, 0], intensity: 0.9, name: 'Main Library' },
        { offset: [0.005, 0.005], intensity: 0.7, name: 'Student Center' },
        { offset: [-0.004, 0.006], intensity: 0.65, name: 'Dining Hall' },
        { offset: [0.006, -0.003], intensity: 0.6, name: 'Sports Complex' },
        { offset: [-0.003, -0.005], intensity: 0.55, name: 'Science Building' },
      ];

      // Add hotspot clusters
      hotspots.forEach(spot => {
        const lat = centerLat + spot.offset[0];
        const lng = centerLng + spot.offset[1];

        // Generate multiple points around each hotspot
        for (let i = 0; i < 15; i++) {
          const variance = 0.002;
          data.push([
            lat + (Math.random() - 0.5) * variance,
            lng + (Math.random() - 0.5) * variance,
            spot.intensity + (Math.random() - 0.5) * 0.2,
          ]);
        }
      });

      // Add scattered activity points
      for (let i = 0; i < 20; i++) {
        data.push([
          centerLat + (Math.random() - 0.5) * 0.015,
          centerLng + (Math.random() - 0.5) * 0.015,
          Math.random() * 0.5,
        ]);
      }

      return data;
    }

    /**
     * Initialize heatmap with university-specific coordinates
     */
    function initializeHeatMap() {
      // Get stored university
      const universityName = localStorage.getItem('connectu_university');
      let coords = { lat: 43.6629, lng: -79.3957 }; // Default to UofT
      let displayName = 'University of Toronto';

      if (universityName) {
        const univCoords = getUniversityCoords(universityName);
        if (univCoords) {
          coords = { lat: univCoords.lat, lng: univCoords.lng };
          displayName = univCoords.name;
        }
      }

      // Update university label
      const universityLabel = document.getElementById('universityLabel');
      if (universityLabel) {
        universityLabel.textContent = `üìç ${displayName}`;
      }

      // Initialize map
      const map = L.map('heatMapContainer').setView([coords.lat, coords.lng], 15);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors',
        maxZoom: 19,
      }).addTo(map);

      // Generate realistic heatmap data around campus
      const heatData = generateCampusHeatData(coords.lat, coords.lng);

      // Add heatmap layer
      L.heatLayer(heatData, {
        radius: 25,
        blur: 15,
        maxZoom: 1,
        gradient: { 0.4: 'blue', 0.65: 'cyan', 0.8: 'yellow', 1.0: 'red' },
      }).addTo(map);

      // Add campus marker
      L.marker([coords.lat, coords.lng], {
        title: displayName,
      })
        .addTo(map)
        .bindPopup(`<b>${displayName}</b><br>Active Study Zone`)
        .openPopup();
    }

    function renderTab(tab) {
      tabContent.innerHTML = tabData[tab];
      [...tabHeader.children].forEach(btn => btn.classList.toggle('active', btn.dataset.tab === tab));
      activeTab = tab;

      // Initialize Leaflet map if heatmap tab is active
      if (tab === 'heatmap') {
        setTimeout(() => {
          const mapContainer = document.getElementById('heatMapContainer');
          if (mapContainer && !mapContainer._leaflet_id) {
            initializeHeatMap();
          }
        }, 100);
      }
    }

    tabHeader.addEventListener('click', e => {
      if (e.target.tagName === 'BUTTON') {
        const tab = e.target.dataset.tab;
        if (tab && tab !== activeTab) {
          renderTab(tab);
        }
      }
    });

    // Housing Marketplace - Fresh Implementation with Filters
    const housingListings = [
      // University of Toronto
      { title: 'Cozy Studio', price: 650, bedrooms: 1, type: 'Room', amenities: 'WiFi, Furnished, Shared', university: 'University of Toronto', address: '45 Bloor St W', budget: 'budget' },
      { title: 'Shared 2BR Apartment', price: 850, bedrooms: 2, type: 'Apartment', amenities: 'Kitchen, Laundry, Parking', university: 'University of Toronto', address: '123 Dundas St W', budget: 'moderate' },
      { title: 'Modern 1BR Loft', price: 1050, bedrooms: 1, type: 'Apartment', amenities: 'AC, Gym, Balcony', university: 'University of Toronto', address: '567 King St W', budget: 'moderate' },
      { title: '3BR House', price: 1450, bedrooms: 3, type: 'House', amenities: 'Yard, Garage, Pet OK', university: 'University of Toronto', address: '890 Queen St E', budget: 'premium' },
      { title: 'Premium 2BR Condo', price: 1650, bedrooms: 2, type: 'Apartment', amenities: 'Pool, Gym, Concierge', university: 'University of Toronto', address: '234 Yonge St', budget: 'premium' },
      { title: 'Student Room', price: 550, bedrooms: 1, type: 'Room', amenities: 'Furnished, WiFi, Utilities Inc.', university: 'University of Toronto', address: '78 College St', budget: 'budget' },
      
      // University of Waterloo
      { title: 'Basement Bachelor', price: 600, bedrooms: 1, type: 'Room', amenities: 'Independent Entry, WiFi', university: 'University of Waterloo', address: '200 University Ave W', budget: 'budget' },
      { title: 'Shared 2BR', price: 800, bedrooms: 2, type: 'Apartment', amenities: 'Full Kitchen, Washer/Dryer, Close to Campus', university: 'University of Waterloo', address: '450 Columbia St', budget: 'moderate' },
      { title: '1BR Suite', price: 900, bedrooms: 1, type: 'Apartment', amenities: 'Private Bathroom, Furnished', university: 'University of Waterloo', address: '175 King St S', budget: 'moderate' },
      { title: 'House for 4', price: 1250, bedrooms: 4, type: 'House', amenities: 'Backyard, Parking, Pet Friendly', university: 'University of Waterloo', address: '380 Bridgeport Rd', budget: 'premium' },
      { title: 'Downtown Apartment', price: 1000, bedrooms: 1, type: 'Apartment', amenities: 'Transit Access, Modern Kitchen', university: 'University of Waterloo', address: '99 Queen St S', budget: 'moderate' },
      { title: 'Luxury Penthouse', price: 1800, bedrooms: 2, type: 'Apartment', amenities: 'City Views, Gym, Spa', university: 'University of Waterloo', address: '500 Market St', budget: 'premium' },
      
      // McMaster University
      { title: 'Budget Room', price: 620, bedrooms: 1, type: 'Room', amenities: 'WiFi, Furnished', university: 'McMaster University', address: '1280 Main St W', budget: 'budget' },
      { title: '2BR Shared', price: 780, bedrooms: 2, type: 'Apartment', amenities: 'Kitchen, Laundry, Utilities', university: 'McMaster University', address: '150 Duke St', budget: 'moderate' },
      { title: '1BR Cozy', price: 920, bedrooms: 1, type: 'Apartment', amenities: 'Furnished, AC, WiFi', university: 'McMaster University', address: '345 King St E', budget: 'moderate' },
      { title: '3BR House', price: 1380, bedrooms: 3, type: 'House', amenities: 'Garden, Garage, Pet OK', university: 'McMaster University', address: '567 Mountain Ave', budget: 'premium' },
      { title: 'Premium Condo', price: 1620, bedrooms: 2, type: 'Apartment', amenities: 'Pool, Concierge, Gym', university: 'McMaster University', address: '200 Cannon St E', budget: 'premium' },
      { title: 'Student Basement', price: 580, bedrooms: 1, type: 'Room', amenities: 'Separate Entry, WiFi', university: 'McMaster University', address: '100 York Blvd', budget: 'budget' },
      
      // Western University
      { title: 'Dorm-Style Room', price: 640, bedrooms: 1, type: 'Room', amenities: 'WiFi, Furnished, Utilities', university: 'Western University', address: '1151 Richmond St N', budget: 'budget' },
      { title: 'Shared 2BR', price: 820, bedrooms: 2, type: 'Apartment', amenities: 'Full Kitchen, Laundry, Parking', university: 'Western University', address: '280 Dundas St', budget: 'moderate' },
      { title: '1BR Modern', price: 950, bedrooms: 1, type: 'Apartment', amenities: 'AC, Balcony, Gym', university: 'Western University', address: '450 Proudfoot Ln', budget: 'moderate' },
      { title: 'House for Students', price: 1300, bedrooms: 4, type: 'House', amenities: 'Large Yard, Garage', university: 'Western University', address: '123 Colborne St', budget: 'premium' },
      { title: 'Luxury 2BR', price: 1700, bedrooms: 2, type: 'Apartment', amenities: 'Premium Finishes, Concierge', university: 'Western University', address: '567 Oxford St', budget: 'premium' },
      { title: 'Shared Room', price: 570, bedrooms: 1, type: 'Room', amenities: 'WiFi, Furnished', university: 'Western University', address: '90 Windermere Ave', budget: 'budget' },
      
      // York University
      { title: 'Budget Studio', price: 610, bedrooms: 1, type: 'Room', amenities: 'WiFi, Furnished', university: 'York University', address: '4700 Keele St', budget: 'budget' },
      { title: '2BR Apartment', price: 790, bedrooms: 2, type: 'Apartment', amenities: 'Kitchen, Laundry, TTC Access', university: 'York University', address: '100 University Dr', budget: 'moderate' },
      { title: '1BR Apartment', price: 900, bedrooms: 1, type: 'Apartment', amenities: 'Furnished, Utilities Inc.', university: 'York University', address: '200 Steeles Ave W', budget: 'moderate' },
      { title: '3BR House', price: 1320, bedrooms: 3, type: 'House', amenities: 'Backyard, Parking', university: 'York University', address: '300 Sentinel Rd', budget: 'premium' },
      { title: 'Premium Condo', price: 1680, bedrooms: 2, type: 'Apartment', amenities: 'Gym, Pool, Concierge', university: 'York University', address: '500 Murray Ross Pkwy', budget: 'premium' },
      { title: 'Shared Room', price: 590, bedrooms: 1, type: 'Room', amenities: 'Furnished, WiFi', university: 'York University', address: '50 Assiniboine Rd', budget: 'budget' },
    ];

    window.loadHousingListings = function(type) {
      const container = document.getElementById('housingContent');
      
      // Get user's university from sessionStorage
      const user = JSON.parse(sessionStorage.getItem('connectu_user') || '{}');
      const userUniversity = user.school || null;
      
      // Filter listings by university if user has one selected
      let filteredListings = userUniversity 
        ? housingListings.filter(l => l.university === userUniversity)
        : housingListings;
      
      // Build filter UI and listings
      let html = `
        <div style="margin-bottom: 2rem;">
          <h3 style="color: #cbd5e1; margin-bottom: 1rem;">Filter Listings</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <div>
              <label style="display: block; font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.5rem;">Budget</label>
              <select id="budgetFilter" style="width: 100%; padding: 0.5rem; background: rgba(15, 23, 42, 0.8); color: #fff; border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 6px; cursor: pointer;" onchange="window.applyHousingFilters()">
                <option value="">All Budgets</option>
                <option value="budget">Budget ($500-$800)</option>
                <option value="moderate">Moderate ($800-$1200)</option>
                <option value="premium">Premium ($1200+)</option>
              </select>
            </div>
            <div>
              <label style="display: block; font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.5rem;">Housing Style</label>
              <select id="typeFilter" style="width: 100%; padding: 0.5rem; background: rgba(15, 23, 42, 0.8); color: #fff; border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 6px; cursor: pointer;" onchange="window.applyHousingFilters()">
                <option value="">All Types</option>
                <option value="Room">Room</option>
                <option value="Apartment">Apartment</option>
                <option value="House">House</option>
              </select>
            </div>
          </div>
        </div>
        
        <div id="listingsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;"></div>
      `;
      
      container.innerHTML = html;
      
      // Store listings for filtering
      window.allHousingListings = filteredListings;
      window.applyHousingFilters();
    };

    window.applyHousingFilters = function() {
      const budgetFilter = document.getElementById('budgetFilter')?.value || '';
      const typeFilter = document.getElementById('typeFilter')?.value || '';
      const grid = document.getElementById('listingsGrid');
      
      let filtered = window.allHousingListings || [];
      
      if (budgetFilter) {
        filtered = filtered.filter(l => l.budget === budgetFilter);
      }
      if (typeFilter) {
        filtered = filtered.filter(l => l.type === typeFilter);
      }
      
      let html = '';
      filtered.forEach(listing => {
        html += `
          <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(6, 182, 212, 0.05)); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 12px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 12px 24px rgba(139, 92, 246, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
            <div style="font-size: 1.5rem; font-weight: 800; color: #10b981; margin-bottom: 0.5rem;">$${listing.price}/mo</div>
            <div style="font-size: 1.1rem; font-weight: 700; color: #fff; margin-bottom: 0.2rem;">${listing.title}</div>
            <div style="font-size: 0.85rem; color: #cbd5e1; margin-bottom: 0.3rem;">üìç ${listing.address}</div>
            <div style="font-size: 0.85rem; color: #94a3b8; margin-bottom: 1rem;">üè´ ${listing.university}</div>
            <div style="font-size: 0.9rem; color: #cbd5e1; margin-bottom: 1rem;">
              <span style="display: inline-block; margin-right: 1rem;">üõèÔ∏è ${listing.bedrooms} bed${listing.bedrooms > 1 ? 's' : ''}</span>
              <span>üè† ${listing.type}</span>
            </div>
            <div style="font-size: 0.85rem; color: #a7c1d9; padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
              <strong>Amenities:</strong><br>${listing.amenities}
            </div>
          </div>
        `;
      });
      
      if (!html) {
        html = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #94a3b8;">No listings match your filters</div>';
      }
      
      grid.innerHTML = html;
    };

    // Initial render
    renderTab(activeTab);
  </script>
  <script src="./js/animated-background.js"></script>
</body>
</html>
