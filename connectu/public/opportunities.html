<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Opportunities ‚Äî ConnectU</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./css/styles.css" />
    <!-- Add Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background:
          radial-gradient(1200px 600px at 10% 10%, #7b61ff22, transparent),
          radial-gradient(900px 500px at 90% 90%, #34d39922, transparent),
          linear-gradient(180deg, #0f172a 0%, #0b1220 100%);
        color: #e6eef8;
        font-family:
          "Inter",
          system-ui,
          -apple-system,
          "Segoe UI",
          Roboto,
          "Helvetica Neue",
          Arial,
          sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .opportunities-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100vh;
        overflow: hidden;
        position: relative;
        z-index: 1;
      }

      .opportunities-header {
        background: linear-gradient(
          180deg,
          rgba(15, 23, 42, 0.98),
          rgba(11, 18, 32, 0.99)
        );
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding: 1.5rem 2rem;
        display: flex;
        align-items: center;
        backdrop-filter: blur(16px);
        position: relative;
        z-index: 2;
      }

      .opportunities-header .profile-banner {
        display: none;
      }

      .header-content {
        flex: 1;
        display: grid;
        grid-template-columns: 1fr auto;
        align-items: center;
        gap: 1rem;
      }

      .opportunities-title {
        font-size: 2rem;
        font-weight: 900;
        letter-spacing: 2px;
        color: #fff;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        text-align: center;
        grid-column: 1;
        margin: 0;
        width: 100%;
      }

      .opportunities-back {
        background: linear-gradient(90deg, #8b5cf6, #06b6d4);
        color: #021124;
        border: none;
        padding: 0.75rem 1.25rem;
        border-radius: 10px;
        font-weight: 700;
        cursor: pointer;
        font-size: 0.95rem;
        transition:
          transform 0.15s ease,
          box-shadow 0.15s ease;
        grid-column: 2;
        white-space: nowrap;
      }

      .opportunities-back:hover {
        transform: translateY(-2px);
        box-shadow: 0 14px 36px rgba(2, 6, 23, 0.35);
      }

      .opportunities-tabs {
        display: flex;
        gap: 0.5rem;
        padding: 1rem 2rem;
        background: rgba(15, 23, 42, 0.98);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        overflow-x: auto;
        backdrop-filter: blur(16px);
        position: relative;
        z-index: 2;
      }

      .tab-btn {
        padding: 0.65rem 1rem;
        background: rgba(15, 23, 42, 0.85);
        color: #e6eef8;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.9rem;
        white-space: nowrap;
        transition: all 0.25s ease;
        backdrop-filter: blur(8px);
      }

      .tab-btn:hover {
        background: rgba(15, 23, 42, 0.92);
        border-color: rgba(255, 255, 255, 0.25);
        color: #fff;
      }

      .tab-btn.active {
        background: linear-gradient(90deg, #8b5cf6, #06b6d4);
        color: #021124;
        border-color: transparent;
      }

      .opportunities-content {
        flex: 1;
        overflow-y: auto;
        padding: 2rem;
        background: rgba(15, 23, 42, 0.95);
        position: relative;
        z-index: 1;
      }

      .tab-panel {
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .tab-panel.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .feature-box {
        background: linear-gradient(
          180deg,
          rgba(15, 23, 42, 0.98),
          rgba(11, 18, 32, 0.99)
        );
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        backdrop-filter: blur(16px);
        position: relative;
        z-index: 1;
      }

      .feature-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .feature-description {
        color: #e6eef8;
        line-height: 1.6;
        margin-bottom: 1rem;
      }

      .feature-highlight {
        background: rgba(15, 23, 42, 0.98);
        border-left: 3px solid #6366f1;
        padding: 1rem;
        border-radius: 8px;
        color: #fff;
        font-size: 0.95rem;
        margin: 1rem 0;
        backdrop-filter: blur(12px);
        position: relative;
        z-index: 1;
      }

      .metric-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .metric-card {
        background: rgba(15, 23, 42, 0.92);
        padding: 1rem;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(8px);
      }

      .metric-label {
        font-size: 0.85rem;
        color: #cbd5e1;
        margin-bottom: 0.5rem;
      }

      .metric-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: #fff;
      }

      .opportunity-card {
        background: rgba(15, 23, 42, 0.92);
        padding: 1.25rem;
        border-radius: 12px;
        margin: 0.75rem 0;
        border-left: 4px solid #06b6d4;
        cursor: pointer;
        transition: all 0.25s ease;
        backdrop-filter: blur(8px);
      }

      .opportunity-card:hover {
        background: rgba(15, 23, 42, 0.95);
        border-left-color: #8b5cf6;
      }

      .opportunity-emoji {
        display: inline-block;
        font-size: 1.3rem;
        margin-right: 0.5rem;
      }

      .opportunity-label {
        color: #e6eef8;
        font-weight: 600;
      }

      .match-score {
        background: linear-gradient(
          135deg,
          rgba(99, 102, 241, 0.15),
          rgba(6, 182, 212, 0.1)
        );
        padding: 1.25rem;
        border-radius: 12px;
        margin: 1rem 0;
        border: 1px solid rgba(99, 102, 241, 0.2);
      }

      .score-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .score-row:last-child {
        border-bottom: none;
      }

      .score-label {
        color: #e6eef8;
        font-weight: 600;
      }

      .score-value {
        color: #fff;
        font-weight: 700;
      }

      .score-bar {
        width: 100px;
        height: 8px;
        background: rgba(15, 23, 42, 0.95);
        border-radius: 4px;
        overflow: hidden;
      }

      .score-fill {
        background: linear-gradient(90deg, #8b5cf6, #06b6d4);
        height: 100%;
        border-radius: 4px;
      }

      .opportunity-input {
        width: 100%;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        padding: 1rem;
        color: #e6eef8;
        margin-bottom: 1rem;
        font-family: inherit;
        backdrop-filter: blur(8px);
      }

      .opportunity-input::placeholder {
        color: #94a3b8;
      }

      .detail-result {
        background: linear-gradient(
          135deg,
          rgba(99, 102, 241, 0.1),
          rgba(6, 182, 212, 0.05)
        );
        padding: 1.25rem;
        border-radius: 12px;
        margin: 1rem 0;
        border: 1px solid rgba(99, 102, 241, 0.2);
      }

      .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 0.75rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .detail-row:last-child {
        border-bottom: none;
      }

      .detail-label {
        color: #94a3b8;
        font-weight: 600;
      }

      .detail-value {
        color: #fff;
        font-weight: 700;
      }

      #map {
        width: 100%;
        height: 400px;
        border-radius: 12px;
        z-index: 1;
      }

      .leaflet-container {
        border-radius: 12px;
      }

      .university-label {
        color: #94a3b8;
        font-size: 0.95rem;
        text-align: center;
        margin-bottom: 0.5rem;
      }

      @media (max-width: 900px) {
        .opportunities-header {
          flex-direction: column;
          gap: 1rem;
          text-align: center;
        }

        .opportunities-tabs {
          padding: 0.75rem 1rem;
        }

        .tab-btn {
          padding: 0.5rem 0.8rem;
          font-size: 0.85rem;
        }

        .opportunities-content {
          padding: 1rem;
        }

        .metric-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 600px) {
        .opportunities-title {
          font-size: 1.5rem;
        }

        .opportunities-tabs {
          overflow-x: auto;
        }

        .metric-grid {
          grid-template-columns: 1fr;
        }

        .opportunities-content {
          padding: 0.75rem;
        }
      }

      .profile-banner {
        width: 100%;
        height: 120px;
        border-radius: 0;
        position: relative;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display: none;
        margin-bottom: 1rem;
        overflow: hidden;
      }

      .profile-banner.loaded {
        display: block;
      }

      .profile-banner::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          180deg,
          rgba(15, 23, 42, 0.85) 0%,
          rgba(15, 23, 42, 0.4) 100%
        );
        border-radius: inherit;
      }

      .linkedin-profile-section {
        background: linear-gradient(
          135deg,
          rgba(139, 92, 246, 0.1),
          rgba(6, 182, 212, 0.05)
        );
        border: 2px solid rgba(139, 92, 246, 0.3);
        border-radius: 16px;
        padding: 2rem;
        margin: 0 2rem 2rem 2rem;
        text-align: center;
        display: none;
      }

      .linkedin-profile {
        max-width: 200px;
        max-height: 200px;
        width: auto;
        height: auto;
        display: inline-block;
        border-radius: 50%;
        filter: drop-shadow(0 4px 16px rgba(139, 92, 246, 0.3));
        margin-bottom: 1rem;
        border: 4px solid rgba(255, 255, 255, 0.2);
      }

      .profile-name-display {
        font-size: 1.4rem;
        font-weight: 700;
        color: #fff;
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="opportunities-container">
      <!-- Header -->
      <div class="opportunities-header">
        <div id="profileBanner" class="profile-banner"></div>
        <div class="header-content">
          <h1 class="opportunities-title">OPPORTUNITIES</h1>
          <button class="opportunities-back" onclick="window.history.back();">
            ‚Üê Back
          </button>
        </div>
      </div>

      <!-- LinkedIn Profile Picture Section -->
      <div class="linkedin-profile-section" id="profileSection">
        <img
          id="linkedinProfile"
          class="linkedin-profile"
          alt="LinkedIn Profile"
        />
        <div class="profile-name-display" id="profileNameDisplay"></div>
      </div>

      <!-- Tabs -->
      <div class="opportunities-tabs">
        <button class="tab-btn active" data-tab="study-map">
          Study & Venue Map
        </button>
        <button class="tab-btn" data-tab="match-scanner">Match Scanner</button>
        <button class="tab-btn" data-tab="live-aggregator">
          Live Aggregator
        </button>
        <button class="tab-btn" data-tab="events-and-clubs">
          Events & Clubs
        </button>
      </div>

      <!-- Content -->
      <div class="opportunities-content">
        <!-- Study & Venue Map Tab -->
        <div id="study-map" class="tab-panel active">
          <div class="feature-box">
            <div class="feature-title">Study Spots & Featured Venues</div>
            <div class="feature-description">
              Discover the best places to study, network, and attend events.
              Find quiet corners, collaborative spaces, and venues hosting
              opportunities.
            </div>
          </div>

          <div class="feature-box">
            <div class="university-label" id="universityLabel"></div>
            <div id="map"></div>
          </div>

          <div class="feature-box">
            <div class="feature-title">Featured Study Spots</div>
            <div class="opportunity-card">
              <span class="opportunity-emoji">üìö</span>
              <span class="opportunity-label"
                >Central Library ‚Äî Quiet Zone</span
              >
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                Floor 3 | Best for: Deep focus work | Hours: 8am-11pm | WiFi:
                Excellent
              </div>
            </div>

            <div class="opportunity-card" style="border-left-color: #8b5cf6">
              <span class="opportunity-emoji">‚òï</span>
              <span class="opportunity-label"
                >Campus Brew Caf√© ‚Äî Collab Space</span
              >
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                Near Student Center | Best for: Group projects | Noise level:
                Moderate | Free wifi
              </div>
            </div>

            <div class="opportunity-card" style="border-left-color: #06b6d4">
              <span class="opportunity-emoji">üíª</span>
              <span class="opportunity-label"
                >Tech Hub ‚Äî Innovation Lounge</span
              >
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                Engineering Building | Best for: Coding, design work |
                Whiteboard walls | Fast internet
              </div>
            </div>
          </div>

          <div class="feature-box">
            <div class="feature-title">Featured Venues Hosting Events</div>
            <div class="opportunity-card">
              <span class="opportunity-emoji">üé™</span>
              <span class="opportunity-label"
                >Convention Center ‚Äî TechCrunch Disrupt</span
              >
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                Downtown | Next event: Feb 15 | Capacity: 2,000+ | Great
                networking
              </div>
            </div>

            <div class="opportunity-card" style="border-left-color: #8b5cf6">
              <span class="opportunity-emoji">üé§</span>
              <span class="opportunity-label">Grand Hall ‚Äî Career Fair</span>
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                On-campus | Next event: Mar 5 | 40+ employers | Resum√© drop-offs
              </div>
            </div>

            <div class="opportunity-card" style="border-left-color: #06b6d4">
              <span class="opportunity-emoji">üé≠</span>
              <span class="opportunity-label"
                >Performing Arts Center ‚Äî Club Showcases</span
              >
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                On-campus | Next event: Feb 22 | All clubs presenting | Open to
                all
              </div>
            </div>
          </div>
        </div>

        <!-- Match Scanner Tab -->
        <div id="match-scanner" class="tab-panel">
          <div class="feature-box">
            <div class="feature-title">Match Scanner ‚Äî Personal Fit Score</div>
            <div class="feature-description">
              Every opportunity gets a personalized match score based on your
              major, skills, projects, and goals. Quick way to know if something
              is right for you.
            </div>
          </div>

          <div class="feature-box">
            <div class="feature-title">Recent Scans</div>
            <div class="match-score">
              <div style="margin-bottom: 1rem">
                <div
                  style="font-weight: 700; color: #fff; margin-bottom: 0.5rem"
                >
                  Shopify Frontend Internship
                </div>
                <div style="display: flex; align-items: center; gap: 0.75rem">
                  <span
                    style="font-size: 1.5rem; font-weight: 700; color: #4ade80"
                    >92%</span
                  >
                  <div class="score-bar" style="width: 150px">
                    <div class="score-fill" style="width: 92%"></div>
                  </div>
                </div>
              </div>
              <div class="score-row">
                <span class="score-label">Skills Match</span>
                <span class="score-value">Excellent (React, TypeScript)</span>
              </div>
              <div class="score-row">
                <span class="score-label">Time Fit</span>
                <span class="score-value">Perfect (Summer)</span>
              </div>
              <div class="score-row">
                <span class="score-label">Career Growth</span>
                <span class="score-value">High impact</span>
              </div>
              <div class="score-row">
                <span class="score-label">Your Fit Reason</span>
                <span class="score-value"
                  >Your GitHub shows strong frontend work</span
                >
              </div>
            </div>

            <div class="match-score">
              <div style="margin-bottom: 1rem">
                <div
                  style="font-weight: 700; color: #fff; margin-bottom: 0.5rem"
                >
                  AI Hackathon ‚Äî TechCrunch
                </div>
                <div style="display: flex; align-items: center; gap: 0.75rem">
                  <span
                    style="font-size: 1.5rem; font-weight: 700; color: #fbbf24"
                    >68%</span
                  >
                  <div class="score-bar" style="width: 150px">
                    <div class="score-fill" style="width: 68%"></div>
                  </div>
                </div>
              </div>
              <div class="score-row">
                <span class="score-label">Team Formation</span>
                <span class="score-value">Good (Need a design partner)</span>
              </div>
              <div class="score-row">
                <span class="score-label">Time Commitment</span>
                <span class="score-value">48 hours (doable)</span>
              </div>
              <div class="score-row">
                <span class="score-label">Networking Value</span>
                <span class="score-value">Very high</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Live Aggregator Tab -->
        <div id="live-aggregator" class="tab-panel">
          <div class="feature-box">
            <div class="feature-title">
              Live Aggregator ‚Äî All Listings in One Place
            </div>
            <div class="feature-description">
              Continuously pulls from LinkedIn, Handshake, Indeed, university
              boards, and more. See new posts instantly without juggling 10
              different sites.
            </div>
          </div>

          <div class="feature-box">
            <div class="feature-title">Fresh Listings (Last 24 Hours)</div>
            <div class="opportunity-card">
              <span class="opportunity-emoji">üíº</span>
              <span class="opportunity-label"
                >Junior Full-Stack Developer ‚Äî Thoughtworks</span
              >
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                Posted 2 hours ago | Apply by: Feb 28 | Remote
              </div>
            </div>

            <div class="opportunity-card" style="border-left-color: #8b5cf6">
              <span class="opportunity-emoji">üìä</span>
              <span class="opportunity-label"
                >Marketing Analyst Internship ‚Äî Hootsuite</span
              >
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                Posted 6 hours ago | Apply by: Mar 15 | Vancouver
              </div>
            </div>

            <div class="opportunity-card" style="border-left-color: #06b6d4">
              <span class="opportunity-emoji">üéì</span>
              <span class="opportunity-label"
                >Scholarship ‚Äî Women in Tech Fund</span
              >
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                Posted 12 hours ago | Apply by: Apr 1 | $5,000 award
              </div>
            </div>
          </div>

          <div class="metric-grid">
            <div class="metric-card">
              <div class="metric-label">New Posts Today</div>
              <div class="metric-value">18</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Urgent Deadlines</div>
              <div class="metric-value">3</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Last Updated</div>
              <div class="metric-value">5 min ago</div>
            </div>
          </div>
        </div>

        <!-- Events & Clubs Tab (Merged) -->
        <div id="events-and-clubs" class="tab-panel">
          <div class="feature-box">
            <div class="feature-title">
              Events & Clubs ‚Äî Hackathons, Events & Community
            </div>
            <div class="feature-description">
              Discover hackathons, competitions, and clubs all in one place.
              Find teams, join communities, and explore what's happening on
              campus.
            </div>
          </div>

          <div class="feature-box">
            <div class="feature-title">Upcoming Hackathons & Events</div>
            <div class="opportunity-card">
              <span class="opportunity-emoji">üèÜ</span>
              <span class="opportunity-label"
                >HackTO 2025 ‚Äî Toronto's Biggest Hackathon</span
              >
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                Feb 15-16 | On-campus | 500+ participants | Looking for team
                members
              </div>
            </div>

            <div class="opportunity-card" style="border-left-color: #8b5cf6">
              <span class="opportunity-emoji">ü§ñ</span>
              <span class="opportunity-label">AI/ML Hackathon ‚Äî Virtual</span>
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                Mar 1-2 | Online | $15K prize pool | 3-4 person teams
              </div>
            </div>

            <div class="opportunity-card" style="border-left-color: #06b6d4">
              <span class="opportunity-emoji">üé®</span>
              <span class="opportunity-label">Design Sprint ‚Äî UX Track</span>
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                Feb 22-23 | Hybrid | Design + Dev collaboration | Teams forming
                now
              </div>
            </div>
          </div>

          <div class="feature-box">
            <div class="feature-title">Featured Clubs</div>
            <div class="opportunity-card">
              <span class="opportunity-emoji">üöÄ</span>
              <span class="opportunity-label">Entrepreneurship Club</span>
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                234 members | Very Active | Monthly pitch nights + startup guest
                speakers
              </div>
            </div>

            <div class="opportunity-card" style="border-left-color: #8b5cf6">
              <span class="opportunity-emoji">üß†</span>
              <span class="opportunity-label">AI/ML Student Group</span>
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                189 members | Very Active | Workshops + Paper reading sessions |
                Seeking VP Outreach
              </div>
            </div>

            <div class="opportunity-card" style="border-left-color: #06b6d4">
              <span class="opportunity-emoji">üéµ</span>
              <span class="opportunity-label">Music & Performance Society</span>
              <div
                style="color: #94a3b8; font-size: 0.9rem; margin-top: 0.5rem"
              >
                156 members | Moderately Active | Jam sessions every Fri |
                Looking for organizers
              </div>
            </div>
          </div>

          <div class="metric-grid">
            <div class="metric-card">
              <div class="metric-label">Hackathons This Month</div>
              <div class="metric-value">8</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Total Clubs</div>
              <div class="metric-value">87</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Events This Month</div>
              <div class="metric-value">40</div>
            </div>
            <div class="metric-card">
              <div class="metric-label">Total Prizes Available</div>
              <div class="metric-value">$127K</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Leaflet JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script type="module">
      import { getUniversityCoords } from "./js/university-data.js";

      let mapInstance = null;

      // Study Spots (Blue markers)
      function getStudySpots(centerLat, centerLng) {
        return [
          {
            name: "Central Library ‚Äî Quiet Zone",
            lat: centerLat,
            lng: centerLng,
            type: "study",
          },
          {
            name: "Campus Brew Caf√© ‚Äî Collab Space",
            lat: centerLat + 0.005,
            lng: centerLng - 0.008,
            type: "study",
          },
          {
            name: "Tech Hub ‚Äî Innovation Lounge",
            lat: centerLat - 0.004,
            lng: centerLng + 0.006,
            type: "study",
          },
          {
            name: "Student Commons Study Area",
            lat: centerLat + 0.008,
            lng: centerLng,
            type: "study",
          },
        ];
      }

      // Featured Venues (Purple markers)
      function getVenues(centerLat, centerLng) {
        return [
          {
            name: "Convention Center",
            lat: centerLat - 0.02,
            lng: centerLng - 0.015,
            type: "venue",
          },
          {
            name: "Grand Hall ‚Äî Career Fair",
            lat: centerLat + 0.004,
            lng: centerLng - 0.012,
            type: "venue",
          },
          {
            name: "Performing Arts Center",
            lat: centerLat - 0.01,
            lng: centerLng - 0.02,
            type: "venue",
          },
        ];
      }

      // Custom icons
      const studyIcon = L.divIcon({
        html: '<div style="background-color: #06b6d4; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üìö</div>',
        iconSize: [30, 30],
        className: "study-marker",
      });

      const venueIcon = L.divIcon({
        html: '<div style="background-color: #8b5cf6; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">üé™</div>',
        iconSize: [30, 30],
        className: "venue-marker",
      });

      function initializeMap() {
        // Get stored university
        const universityName = localStorage.getItem("connectu_university");
        let coords = { lat: 43.6629, lng: -79.3957 }; // Default to UofT
        let displayName = "University of Toronto";

        if (universityName) {
          const univCoords = getUniversityCoords(universityName);
          if (univCoords) {
            coords = { lat: univCoords.lat, lng: univCoords.lng };
            displayName = univCoords.name;
          }
        }

        // Update university label
        const universityLabel = document.getElementById("universityLabel");
        if (universityLabel) {
          universityLabel.textContent = `üìç ${displayName}`;
        }

        // Clear existing map if it exists
        if (mapInstance) {
          mapInstance.remove();
        }

        // Initialize map
        mapInstance = L.map("map").setView([coords.lat, coords.lng], 14);

        // Add OpenStreetMap tiles
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution: "&copy; OpenStreetMap contributors",
          maxZoom: 19,
        }).addTo(mapInstance);

        // Get study spots and venues for this university
        const studySpots = getStudySpots(coords.lat, coords.lng);
        const venues = getVenues(coords.lat, coords.lng);

        // Add study spots
        studySpots.forEach((spot) => {
          L.marker([spot.lat, spot.lng], { icon: studyIcon })
            .bindPopup(
              `<div style="font-weight:600; color:#fff; background:#0f172a; padding:8px; border-radius:6px;">${spot.name}</div>`
            )
            .addTo(mapInstance);
        });

        // Add venues
        venues.forEach((venue) => {
          L.marker([venue.lat, venue.lng], { icon: venueIcon })
            .bindPopup(
              `<div style="font-weight:600; color:#fff; background:#0f172a; padding:8px; border-radius:6px;">${venue.name}</div>`
            )
            .addTo(mapInstance);
        });
      }

      // Tab switching logic
      document.querySelectorAll(".tab-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".tab-btn")
            .forEach((b) => b.classList.remove("active"));
          document
            .querySelectorAll(".tab-panel")
            .forEach((p) => p.classList.remove("active"));

          btn.classList.add("active");
          const tabId = btn.dataset.tab;
          document.getElementById(tabId).classList.add("active");

          // Initialize map when switching to map tab
          if (tabId === "study-map") {
            setTimeout(() => {
              if (!mapInstance) {
                initializeMap();
              } else {
                mapInstance.invalidateSize();
              }
            }, 100);
          }
        });
      });

      // Initialize map on page load
      setTimeout(() => {
        initializeMap();
      }, 100);
    </script>

    <script>
      // Load and display LinkedIn profile picture
      function loadLinkedInProfile() {
        try {
          console.log("Loading LinkedIn profile...");
          const userData = sessionStorage.getItem("connectu_user");
          if (!userData) {
            console.log("No user data found in sessionStorage");
            return;
          }

          const user = JSON.parse(userData);
          const linkedinUrl = user.linkedinUrl;

          console.log("LinkedIn URL from user data:", linkedinUrl);

          if (linkedinUrl) {
            // Extract profile ID or username from LinkedIn URL
            function extractLinkedInProfileId(url) {
              // Handle various LinkedIn URL formats:
              // https://www.linkedin.com/in/username/
              // https://linkedin.com/in/username
              // https://www.linkedin.com/in/username/?originalSubdomain=ca
              const match = url.match(/linkedin\.com\/in\/([^\/\?]+)/i);
              if (match && match[1]) {
                return match[1];
              }
              return null;
            }

            // Function to test if an image URL is valid
            function testImageUrl(url) {
              return new Promise((resolve) => {
                const img = new Image();
                img.crossOrigin = "anonymous";
                let resolved = false;

                const cleanup = () => {
                  if (!resolved) {
                    resolved = true;
                  }
                };

                img.onload = () => {
                  if (!resolved) {
                    resolved = true;
                    resolve(true);
                  }
                };

                img.onerror = () => {
                  if (!resolved) {
                    resolved = true;
                    resolve(false);
                  }
                };

                // Set timeout to avoid hanging
                const timeout = setTimeout(() => {
                  if (!resolved) {
                    resolved = true;
                    resolve(false);
                  }
                }, 3000);

                img.src = url;
              });
            }

            // Function to get LinkedIn profile picture URL
            async function fetchLinkedInProfilePicture(profileId) {
              if (!profileId) return null;

              // Try multiple methods to get the profile picture
              const methods = [
                // Method 1: Try using CORS proxy to fetch og:image from LinkedIn page
                async () => {
                  try {
                    const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(`https://www.linkedin.com/in/${profileId}/`)}`;
                    const response = await fetch(proxyUrl);
                    const data = await response.json();

                    if (data.contents) {
                      // Pattern 1: Look for og:image meta tag (most reliable)
                      const ogImageMatch = data.contents.match(
                        /<meta[^>]*property=["']og:image["'][^>]*content=["']([^"']+)["']/i
                      );
                      if (ogImageMatch && ogImageMatch[1]) {
                        const imageUrl = ogImageMatch[1].replace(/&amp;/g, "&");
                        const isValid = await testImageUrl(imageUrl);
                        if (isValid) return imageUrl;
                      }

                      // Pattern 2: Look for LinkedIn CDN image URLs
                      const cdnMatches = data.contents.match(
                        /https:\/\/media\.licdn\.com\/dms\/image\/[^"'\s<>]+/gi
                      );
                      if (cdnMatches && cdnMatches.length > 0) {
                        // Try the first few CDN URLs
                        for (const url of cdnMatches.slice(0, 3)) {
                          const cleanUrl = url
                            .replace(/[<>"']/g, "")
                            .split("?")[0];
                          const isValid = await testImageUrl(cleanUrl);
                          if (isValid) return cleanUrl;
                        }
                      }
                    }
                  } catch (error) {
                    console.log("Method 1 failed:", error);
                  }
                  return null;
                },

                // Method 2: Try alternative proxy services
                async () => {
                  try {
                    const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(`https://www.linkedin.com/in/${profileId}/`)}`;
                    const response = await fetch(proxyUrl);
                    const html = await response.text();

                    if (html) {
                      const ogImageMatch = html.match(
                        /<meta[^>]*property=["']og:image["'][^>]*content=["']([^"']+)["']/i
                      );
                      if (ogImageMatch && ogImageMatch[1]) {
                        const imageUrl = ogImageMatch[1].replace(/&amp;/g, "&");
                        const isValid = await testImageUrl(imageUrl);
                        if (isValid) return imageUrl;
                      }
                    }
                  } catch (error) {
                    console.log("Method 2 failed:", error);
                  }
                  return null;
                },

                // Method 3: Try using LinkedIn's public profile image endpoint pattern
                async () => {
                  try {
                    // Try to construct a potential profile image URL
                    // This is a fallback that might work for some profiles
                    const potentialUrls = [
                      `https://media.licdn.com/dms/image/C4E03AQ${profileId}/profile-displayphoto-shrink_200_200/0/1234567890?e=1234567890&v=beta&t=abc123`,
                    ];

                    // This method is less reliable, so we'll skip it for now
                    // and rely on the proxy methods above
                  } catch (error) {
                    console.log("Method 3 failed:", error);
                  }
                  return null;
                },

                // Method 4: Try using another CORS proxy
                async () => {
                  try {
                    const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(`https://www.linkedin.com/in/${profileId}/`)}`;
                    const response = await fetch(proxyUrl);
                    const html = await response.text();

                    if (html) {
                      // Look for og:image
                      const ogImageMatch = html.match(
                        /<meta[^>]*property=["']og:image["'][^>]*content=["']([^"']+)["']/i
                      );
                      if (ogImageMatch && ogImageMatch[1]) {
                        const imageUrl = ogImageMatch[1].replace(/&amp;/g, "&");
                        const isValid = await testImageUrl(imageUrl);
                        if (isValid) {
                          console.log("Method 4 succeeded with URL:", imageUrl);
                          return imageUrl;
                        }
                      }

                      // Also try to find any LinkedIn CDN images
                      const cdnMatches = html.match(
                        /https:\/\/media\.licdn\.com\/dms\/image\/[^"'\s<>]+/gi
                      );
                      if (cdnMatches && cdnMatches.length > 0) {
                        for (const url of cdnMatches.slice(0, 5)) {
                          const cleanUrl = url
                            .replace(/[<>"']/g, "")
                            .split("?")[0];
                          // Check if it looks like a profile picture (contains profile-displayphoto)
                          if (
                            cleanUrl.includes("profile-displayphoto") ||
                            cleanUrl.includes("profile")
                          ) {
                            const isValid = await testImageUrl(cleanUrl);
                            if (isValid) {
                              console.log(
                                "Method 4 found profile image:",
                                cleanUrl
                              );
                              return cleanUrl;
                            }
                          }
                        }
                      }
                    }
                  } catch (error) {
                    console.log("Method 4 failed:", error);
                  }
                  return null;
                },
              ];

              // Try each method in sequence
              for (const method of methods) {
                try {
                  const result = await method();
                  if (result) {
                    return result;
                  }
                } catch (error) {
                  console.log("Method failed:", error);
                  continue;
                }
              }

              return null;
            }

            const profileId = extractLinkedInProfileId(linkedinUrl);

            console.log("Extracted profile ID:", profileId);

            if (profileId) {
              // Extract name from LinkedIn URL or use profile ID
              const displayName = profileId
                .replace(/-/g, " ")
                .replace(/\b\w/g, (l) => l.toUpperCase());

              console.log("Fetching profile picture for:", profileId);

              fetchLinkedInProfilePicture(profileId)
                .then((profilePictureUrl) => {
                  const profileImg = document.getElementById("linkedinProfile");
                  const profileSection =
                    document.getElementById("profileSection");
                  const profileBanner =
                    document.getElementById("profileBanner");
                  const nameDisplay =
                    document.getElementById("profileNameDisplay");

                  if (nameDisplay) {
                    nameDisplay.textContent = displayName;
                  }

                  // Only display if we have a valid profile picture URL
                  if (profilePictureUrl) {
                    console.log(
                      "Found profile picture URL:",
                      profilePictureUrl
                    );

                    // Set up the profile image in the section
                    if (profileImg) {
                      profileImg.src = profilePictureUrl;
                      profileImg.alt = `${displayName} LinkedIn Profile`;
                      profileImg.onload = function () {
                        console.log("Profile image loaded successfully");
                        // Only show section if profile picture loaded successfully
                        if (profileSection) {
                          profileSection.style.display = "block";
                        }
                      };
                      profileImg.onerror = function () {
                        console.log(
                          "Profile picture failed to load from URL:",
                          profilePictureUrl
                        );
                        // Don't show section if profile picture fails to load
                        if (profileSection) {
                          profileSection.style.display = "none";
                        }
                      };
                    }

                    // Also add to banner if it exists
                    if (profileBanner) {
                      // Clear any existing content
                      profileBanner.innerHTML = "";
                      const bannerImg = document.createElement("img");
                      bannerImg.src = profilePictureUrl;
                      bannerImg.alt = `${displayName} banner`;
                      bannerImg.style.width = "100%";
                      bannerImg.style.height = "100%";
                      bannerImg.style.objectFit = "cover";
                      bannerImg.style.borderRadius = "0";
                      bannerImg.onload = function () {
                        console.log("Banner image loaded successfully");
                        profileBanner.style.display = "block";
                        profileBanner.classList.add("loaded");
                      };
                      bannerImg.onerror = function () {
                        console.log("Banner image failed to load");
                        // If banner image fails, remove it
                        profileBanner.innerHTML = "";
                        profileBanner.style.display = "none";
                      };
                      profileBanner.appendChild(bannerImg);
                    }
                  } else {
                    console.log(
                      "No valid profile picture URL found for:",
                      profileId
                    );
                    // Don't show profile section if no valid URL
                    if (profileSection) {
                      profileSection.style.display = "none";
                    }
                    if (profileBanner) {
                      profileBanner.style.display = "none";
                    }
                  }
                })
                .catch((error) => {
                  console.error(
                    "Error loading LinkedIn profile picture:",
                    error
                  );
                  // Don't show section if there's an error
                  const profileSection =
                    document.getElementById("profileSection");
                  if (profileSection) {
                    profileSection.style.display = "none";
                  }
                });
            } else {
              console.log(
                "Could not extract profile ID from LinkedIn URL:",
                linkedinUrl
              );
              const profileSection = document.getElementById("profileSection");
              if (profileSection) {
                profileSection.style.display = "none";
              }
            }
          } else {
            // No LinkedIn URL provided
            const profileSection = document.getElementById("profileSection");
            if (profileSection) {
              profileSection.style.display = "none";
            }
          }
        } catch (error) {
          console.error("Error loading LinkedIn profile:", error);
          const profileSection = document.getElementById("profileSection");
          if (profileSection) {
            profileSection.style.display = "none";
          }
        }
      }

      // Run when DOM is ready
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", loadLinkedInProfile);
      } else {
        // DOM is already ready
        loadLinkedInProfile();
      }
    </script>
    <script src="./js/animated-background.js"></script>
  </body>
</html>
